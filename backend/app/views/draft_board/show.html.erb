<div class="mb-2" data-league-id="<%= @league.id %>">
  <%= link_to "← Back to League", league_path(@league), class: "btn btn-sm" %>
</div>

<div class="card mb-3">
  <h2 class="card-title"><%= @league.name %> - Draft Board</h2>
  <p class="text-muted">
    <%= @draft_picks.count %> picks made •
    <%= @available_players.count %> available players shown
  </p>
</div>

<div class="grid" style="grid-template-columns: 2fr 1fr; gap: 1rem;">
  <!-- Draft History -->
  <div class="card">
    <h3 class="card-title">Draft Picks</h3>
    <% if @draft_picks.any? %>
      <div style="max-height: 600px; overflow-y: auto;">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Player</th>
              <th>Team</th>
              <th>Price</th>
              <th>Type</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="draft-picks">
            <%= render partial: "draft_board/draft_picks_table", locals: { draft_picks: @draft_picks } %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-muted text-center">No picks yet. Draft hasn't started!</p>
    <% end %>
  </div>

  <!-- Available Players -->
  <div class="card" data-controller="draft-modal">
    <h3 class="card-title">Top Available Players</h3>

    <!-- Error display area -->
    <div id="draft-error"></div>

    <div style="max-height: 600px; overflow-y: auto;">
      <table>
        <thead>
          <tr>
            <th>Player</th>
            <th>Value</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="available-players-list">
          <%= render partial: "draft_board/available_players_table", locals: { available_players: @available_players } %>
        </tbody>
      </table>
    </div>
    <div class="mt-2">
      <%= link_to "View All Players", players_path, class: "btn btn-secondary btn-sm" %>
    </div>

    <!-- Draft Player Modal -->
    <div class="modal hidden" data-draft-modal-target="modal" data-action="click->draft-modal#closeOnOutsideClick">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Draft Player</h3>
          <button class="modal-close" data-action="click->draft-modal#close" type="button">
            ×
          </button>
        </div>

        <div class="modal-body">
          <!-- Player Details -->
          <div class="player-details">
            <div class="player-details-row">
              <span class="player-details-label">Player:</span>
              <span class="player-details-value" data-draft-modal-target="playerName"></span>
            </div>
            <div class="player-details-row">
              <span class="player-details-label">Position(s):</span>
              <span class="player-details-value" data-draft-modal-target="playerPosition"></span>
            </div>
            <div class="player-details-row">
              <span class="player-details-label">Team:</span>
              <span class="player-details-value" data-draft-modal-target="playerTeam"></span>
            </div>
            <div class="player-details-row">
              <span class="player-details-label">Calculated Value:</span>
              <span class="player-details-value" data-draft-modal-target="playerValue"></span>
            </div>
          </div>

          <!-- Draft Form -->
          <%= form_with url: draft_picks_path, method: :post, data: { action: "submit->draft-modal#submit", turbo: true } do |f| %>
            <input type="hidden" name="draft_pick[player_id]" data-draft-modal-target="playerId">
            <input type="hidden" name="draft_pick[league_id]" value="<%= @league.id %>">
            <input type="hidden" name="draft_pick[is_keeper]" value="false">

            <div class="form-group">
              <label for="draft-team">Drafting Team</label>
              <select
                id="draft-team"
                name="draft_pick[team_id]"
                data-draft-modal-target="teamSelect"
                required
              >
                <option value="">-- Select Team --</option>
                <% @teams.each do |team| %>
                  <option value="<%= team.id %>">
                    <%= team.name %> ($<%= team.budget_remaining %> remaining)
                  </option>
                <% end %>
              </select>
            </div>

            <div class="form-group">
              <label for="draft-position">Draft Position</label>
              <select
                id="draft-position"
                name="draft_pick[drafted_position]"
                data-draft-modal-target="positionSelect"
                required
              >
                <!-- Options populated dynamically by Stimulus controller -->
              </select>
              <small class="text-muted">
                Note: All players can play UTIL. 1B/3B can play CI. 2B/SS can play MI.
              </small>
            </div>

            <div class="form-group">
              <label for="draft-price">Draft Price ($)</label>
              <input
                type="number"
                id="draft-price"
                name="draft_pick[price]"
                data-draft-modal-target="priceInput"
                min="1"
                max="<%= @league.auction_budget %>"
                required
              >
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-cancel btn-sm" data-action="click->draft-modal#close">
                Cancel
              </button>
              <button type="submit" class="btn btn-primary btn-sm">
                Confirm Draft
              </button>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Team Budgets -->
<div class="card mt-3">
  <h3 class="card-title">Team Budgets</h3>
  <div class="grid grid-3" id="team-budgets">
    <%= render partial: "draft_board/team_budgets", locals: { teams: @teams } %>
  </div>
</div>

<!-- Edit Player Modal (Global) -->
<%= render partial: "players/edit_modal" %>
