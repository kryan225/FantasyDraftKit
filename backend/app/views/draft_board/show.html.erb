<div class="mb-2">
  <%= link_to "← Back to League", league_path(@league), class: "btn btn-sm" %>
</div>

<div class="card mb-3">
  <h2 class="card-title"><%= @league.name %> - Draft Board</h2>
  <p class="text-muted">
    <%= @draft_picks.count %> picks made •
    <%= @available_players.count %> available players shown
  </p>
</div>

<div class="grid" style="grid-template-columns: 2fr 1fr; gap: 1rem;">
  <!-- Draft History -->
  <div class="card">
    <h3 class="card-title">Draft Picks</h3>
    <% if @draft_picks.any? %>
      <div style="max-height: 600px; overflow-y: auto;">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Player</th>
              <th>Team</th>
              <th>Price</th>
              <th>Type</th>
            </tr>
          </thead>
          <tbody id="draft-picks">
            <% @draft_picks.each do |pick| %>
              <tr>
                <td><%= pick.pick_number %></td>
                <td>
                  <strong><%= pick.player.name %></strong>
                  <br>
                  <small class="text-muted"><%= pick.player.positions %> - <%= pick.player.mlb_team %></small>
                </td>
                <td><%= pick.team.name %></td>
                <td><strong>$<%= pick.price %></strong></td>
                <td>
                  <% if pick.is_keeper %>
                    <span class="badge badge-info">Keeper</span>
                  <% else %>
                    <span class="badge badge-success">Draft</span>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-muted text-center">No picks yet. Draft hasnt started!</p>
    <% end %>
  </div>

  <!-- Available Players -->
  <div class="card" data-controller="draft-modal">
    <h3 class="card-title">Top Available Players</h3>
    <div style="max-height: 600px; overflow-y: auto;">
      <table>
        <thead>
          <tr>
            <th>Player</th>
            <th>Value</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% @available_players.each do |player| %>
            <tr>
              <td>
                <strong><%= player.name %></strong>
                <br>
                <small class="text-muted"><%= player.positions %></small>
              </td>
              <td><strong>$<%= player.calculated_value&.round || "?" %></strong></td>
              <td>
                <button
                  class="btn-draft"
                  data-action="click->draft-modal#open"
                  data-player-id="<%= player.id %>"
                  data-player-name="<%= player.name %>"
                  data-player-positions="<%= player.positions %>"
                  data-player-mlb-team="<%= player.mlb_team %>"
                  data-player-value="<%= player.calculated_value&.round || '?' %>"
                >
                  Draft
                </button>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="mt-2">
      <%= link_to "View All Players", players_path, class: "btn btn-secondary btn-sm" %>
    </div>

    <!-- Draft Player Modal -->
    <div class="modal hidden" data-draft-modal-target="modal" data-action="click->draft-modal#closeOnOutsideClick">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Draft Player</h3>
          <button class="modal-close" data-action="click->draft-modal#close" type="button">
            ×
          </button>
        </div>

        <div class="modal-body">
          <!-- Player Details -->
          <div class="player-details">
            <div class="player-details-row">
              <span class="player-details-label">Player:</span>
              <span class="player-details-value" data-draft-modal-target="playerName"></span>
            </div>
            <div class="player-details-row">
              <span class="player-details-label">Position(s):</span>
              <span class="player-details-value" data-draft-modal-target="playerPosition"></span>
            </div>
            <div class="player-details-row">
              <span class="player-details-label">Team:</span>
              <span class="player-details-value" data-draft-modal-target="playerTeam"></span>
            </div>
            <div class="player-details-row">
              <span class="player-details-label">Calculated Value:</span>
              <span class="player-details-value" data-draft-modal-target="playerValue"></span>
            </div>
          </div>

          <!-- Draft Form -->
          <form data-action="submit->draft-modal#submit">
            <input type="hidden" data-draft-modal-target="playerId">

            <div class="form-group">
              <label for="draft-team">Drafting Team</label>
              <select id="draft-team" data-draft-modal-target="teamSelect" required>
                <option value="">-- Select Team --</option>
                <% @teams.each do |team| %>
                  <option value="<%= team.id %>">
                    <%= team.name %> ($<%= team.budget_remaining %> remaining)
                  </option>
                <% end %>
              </select>
            </div>

            <div class="form-group">
              <label for="draft-position">Draft Position</label>
              <select id="draft-position" data-draft-modal-target="positionSelect" required>
                <!-- Options populated dynamically by Stimulus controller -->
              </select>
              <small class="text-muted">
                Note: All players can play UTIL. 1B/3B can play CI. 2B/SS can play MI.
              </small>
            </div>

            <div class="form-group">
              <label for="draft-price">Draft Price ($)</label>
              <input
                type="number"
                id="draft-price"
                data-draft-modal-target="priceInput"
                min="1"
                max="<%= @league.auction_budget %>"
                required
              >
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-cancel btn-sm" data-action="click->draft-modal#close">
                Cancel
              </button>
              <button type="submit" class="btn btn-primary btn-sm">
                Confirm Draft
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Team Budgets -->
<div class="card mt-3">
  <h3 class="card-title">Team Budgets</h3>
  <div class="grid grid-3">
    <% @teams.each do |team| %>
      <div>
        <strong><%= team.name %></strong>
        <br>
        <span class="text-muted">$<%= team.budget_remaining %> remaining</span>
      </div>
    <% end %>
  </div>
</div>
