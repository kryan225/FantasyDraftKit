<div class="card">
  <h2 class="card-title">Player Database</h2>

  <%= form_with url: players_path, method: :get, data: { turbo_frame: "_top" } do |f| %>
    <div class="grid grid-3 mb-3">
      <div class="form-group">
        <%= f.label :search, "Search Player" %>
        <%= f.search_field :search, value: params[:search], placeholder: "Player name..." %>
      </div>

      <div class="form-group">
        <%= f.label :position, "Position" %>
        <%= f.select :position, options_for_select([
          ["All Positions", ""],
          ["Catcher (C)", "C"],
          ["First Base (1B)", "1B"],
          ["Second Base (2B)", "2B"],
          ["Third Base (3B)", "3B"],
          ["Shortstop (SS)", "SS"],
          ["Outfield (OF)", "OF"],
          ["Starting Pitcher (SP)", "SP"],
          ["Relief Pitcher (RP)", "RP"]
        ], params[:position]), {}, { class: "form-control" } %>
      </div>

      <div class="form-group">
        <%= f.label :drafted, "Status" %>
        <%= f.select :drafted, options_for_select([
          ["All Players", ""],
          ["Available Only", "false"],
          ["Drafted Only", "true"]
        ], params[:drafted]), {}, { class: "form-control" } %>
      </div>
    </div>

    <%= f.submit "Filter", class: "btn btn-primary btn-sm" %>
    <%= link_to "Clear Filters", players_path, class: "btn btn-sm" %>
  <% end %>

  <div class="mt-3">
    <p class="text-muted mb-2"><%= @players.count %> players found</p>

    <div style="max-height: 700px; overflow-y: auto;">
      <table>
        <thead>
          <tr>
            <th>Player</th>
            <th>Position</th>
            <th>Team</th>
            <th>Value</th>
            <th>Status</th>
            <th>Projections</th>
          </tr>
        </thead>
        <tbody>
          <% @players.each do |player| %>
            <tr>
              <td><strong><%= player.name %></strong></td>
              <td><%= player.positions %></td>
              <td><%= player.mlb_team %></td>
              <td><strong>$<%= player.calculated_value&.round || "?" %></strong></td>
              <td>
                <% if player.is_drafted %>
                  <span class="badge badge-warning">Drafted</span>
                <% else %>
                  <span class="badge badge-success">Available</span>
                <% end %>
              </td>
              <td class="text-sm">
                <% if player.projections.present? %>
                  <% if player.projections["home_runs"] %>
                    HR: <%= player.projections["home_runs"] %>,
                    R: <%= player.projections["runs"] %>,
                    RBI: <%= player.projections["rbi"] %>,
                    SB: <%= player.projections["stolen_bases"] %>,
                    AVG: <%= player.projections["batting_average"] %>
                  <% elsif player.projections["wins"] %>
                    W: <%= player.projections["wins"] %>,
                    SV: <%= player.projections["saves"] %>,
                    K: <%= player.projections["strikeouts"] %>,
                    ERA: <%= player.projections["era"] %>,
                    WHIP: <%= player.projections["whip"] %>
                  <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
