<div class="mb-2">
  <%= link_to "â† Back to League", league_path(@league), class: "btn btn-sm" %>
</div>

<div class="card">
  <h3 class="card-title">League Standings</h3>
  <p class="text-muted mb-3"><%= @league.name %> - Rotisserie Scoring</p>

  <div style="overflow-x: auto;">
    <table>
      <thead>
        <tr>
          <th rowspan="2">Team</th>
          <th rowspan="2">Total<br>Points</th>
          <th colspan="6" style="text-align: center; background-color: #f0f8ff; border-bottom: 2px solid #4a90e2;">Batting</th>
          <th colspan="6" style="text-align: center; background-color: #fff5f0; border-bottom: 2px solid #e2994a;">Pitching</th>
        </tr>
        <tr>
          <!-- Hitter Categories -->
          <th style="background-color: #f0f8ff;">HR</th>
          <th style="background-color: #f0f8ff;">R</th>
          <th style="background-color: #f0f8ff;">RBI</th>
          <th style="background-color: #f0f8ff;">SB</th>
          <th style="background-color: #f0f8ff;">AVG</th>
          <th style="background-color: #f0f8ff;">AB</th>
          <!-- Pitcher Categories -->
          <th style="background-color: #fff5f0;">W</th>
          <th style="background-color: #fff5f0;">SV</th>
          <th style="background-color: #fff5f0;">K</th>
          <th style="background-color: #fff5f0;">ERA</th>
          <th style="background-color: #fff5f0;">WHIP</th>
          <th style="background-color: #fff5f0;">IP</th>
        </tr>
      </thead>
      <tbody>
        <% @team_stats.sort_by { |ts| @rankings[ts[:team].id][:total_points] }.each do |team_stat| %>
          <% team = team_stat[:team] %>
          <% stats = team_stat[:stats] %>
          <% ranks = @rankings[team.id] %>
          <tr>
            <td><strong><%= link_to team.name, team_path(team) %></strong></td>
            <td><strong><%= ranks[:total_points] %></strong></td>

            <!-- Hitter Stats with Ranks -->
            <td style="background-color: #f0f8ff;">
              <%= stats[:home_runs].round(1) %>
              <span class="text-muted" style="font-size: 0.9em;">(#<%= ranks[:home_runs] %>)</span>
            </td>
            <td style="background-color: #f0f8ff;">
              <%= stats[:runs].round(1) %>
              <span class="text-muted" style="font-size: 0.9em;">(#<%= ranks[:runs] %>)</span>
            </td>
            <td style="background-color: #f0f8ff;">
              <%= stats[:rbi].round(1) %>
              <span class="text-muted" style="font-size: 0.9em;">(#<%= ranks[:rbi] %>)</span>
            </td>
            <td style="background-color: #f0f8ff;">
              <%= stats[:stolen_bases].round(1) %>
              <span class="text-muted" style="font-size: 0.9em;">(#<%= ranks[:stolen_bases] %>)</span>
            </td>
            <td style="background-color: #f0f8ff;">
              <%= stats[:batting_average] == 0.0 ? "-" : stats[:batting_average].round(3) %>
              <span class="text-muted" style="font-size: 0.9em;"><% if stats[:batting_average] > 0 %>(#<%= ranks[:batting_average] %>)<% end %></span>
            </td>
            <td class="text-muted" style="background-color: #f0f8ff;">
              <%= stats[:at_bats].round(0) %>
            </td>

            <!-- Pitcher Stats with Ranks -->
            <td style="background-color: #fff5f0;">
              <%= stats[:wins].round(1) %>
              <span class="text-muted" style="font-size: 0.9em;">(#<%= ranks[:wins] %>)</span>
            </td>
            <td style="background-color: #fff5f0;">
              <%= stats[:saves].round(1) %>
              <span class="text-muted" style="font-size: 0.9em;">(#<%= ranks[:saves] %>)</span>
            </td>
            <td style="background-color: #fff5f0;">
              <%= stats[:strikeouts].round(1) %>
              <span class="text-muted" style="font-size: 0.9em;">(#<%= ranks[:strikeouts] %>)</span>
            </td>
            <td style="background-color: #fff5f0;">
              <%= stats[:era] == 0.0 ? "-" : stats[:era].round(2) %>
              <span class="text-muted" style="font-size: 0.9em;"><% if stats[:era] > 0 %>(#<%= ranks[:era] %>)<% end %></span>
            </td>
            <td style="background-color: #fff5f0;">
              <%= stats[:whip] == 0.0 ? "-" : stats[:whip].round(3) %>
              <span class="text-muted" style="font-size: 0.9em;"><% if stats[:whip] > 0 %>(#<%= ranks[:whip] %>)<% end %></span>
            </td>
            <td class="text-muted" style="background-color: #fff5f0;">
              <%= stats[:innings_pitched].round(1) %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="mt-3 text-muted">
    <p><strong>Scoring:</strong> Rotisserie format - teams are ranked 1st through Nth in each category. Total points is the sum of all category ranks. Lower total points is better.</p>
    <p><strong>Categories:</strong></p>
    <ul>
      <li><strong>Hitters:</strong> HR (Home Runs), R (Runs), RBI (Runs Batted In), SB (Stolen Bases), AVG (Batting Average - weighted by AB), AB (Total At-Bats)</li>
      <li><strong>Pitchers:</strong> W (Wins), SV (Saves), K (Strikeouts), ERA (Earned Run Average - weighted by IP), WHIP (Walks + Hits per IP - weighted by IP), IP (Total Innings Pitched)</li>
    </ul>
    <p><strong>Note:</strong> Rate stats (AVG, ERA, WHIP) are calculated as weighted averages based on each player's AB or IP. The AB and IP columns show the total weights used in these calculations.</p>
  </div>
</div>
