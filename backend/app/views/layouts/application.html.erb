<!DOCTYPE html>
<html>
  <head>
    <title>Fantasy Baseball Draft Kit</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body data-controller="edit-player-modal">
    <header>
      <div class="container">
        <div class="flex justify-between items-center">
          <h1>‚öæ Fantasy Baseball Draft Kit</h1>
          <nav>
            <%= link_to "Leagues", leagues_path %>
            <%= link_to "API Docs", "/api_testing_guide.html" %>
          </nav>
        </div>
      </div>
    </header>

    <% if current_league.present? %>
      <div class="league-nav-tabs">
        <div class="container">
          <nav class="tabs">
            <%= link_to "League Home", league_path(current_league), class: "tab #{current_page?(league_path(current_league)) ? 'active' : ''}" %>
            <%= link_to "Draft Board", draft_board_path, class: "tab #{current_page?(draft_board_path) ? 'active' : ''}" %>
            <%= link_to "Teams", league_teams_path(current_league), class: "tab #{current_page?(league_teams_path(current_league)) ? 'active' : ''}" %>
            <%= link_to "Players", league_players_path(current_league), class: "tab #{current_page?(league_players_path(current_league)) ? 'active' : ''}" %>
          </nav>
        </div>
      </div>
    <% end %>

    <main class="container">
      <% if flash[:notice] %>
        <div class="flash flash-notice">
          <%= flash[:notice] %>
        </div>
      <% end %>

      <% if flash[:alert] %>
        <div class="flash flash-alert">
          <%= flash[:alert] %>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <!-- Edit Player Modal (Global) -->
    <div class="modal hidden" data-edit-player-modal-target="modal" data-action="click->edit-player-modal#closeOnOutsideClick">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Edit Player</h3>
          <button class="modal-close" data-action="click->edit-player-modal#close" type="button">
            √ó
          </button>
        </div>

        <div class="modal-body">
          <!-- Error display area -->
          <div id="edit-player-error"></div>

          <!-- Edit Player Form -->
          <%= form_with model: Player.new, url: "", method: :patch,
              data: {
                action: "submit->edit-player-modal#submit",
                turbo: true,
                edit_player_modal_target: "form"
              } do |f| %>

            <input type="hidden" name="_method" value="patch">

            <div class="form-group">
              <label for="player-name">
                Player Name
                <a href="#"
                   target="_blank"
                   rel="noopener noreferrer"
                   data-edit-player-modal-target="googleSearchLink"
                   style="font-size: 0.8em; font-weight: normal; margin-left: 0.5rem; color: #0066cc; text-decoration: none;">
                  üîç Search
                </a>
              </label>
              <input
                type="text"
                id="player-name"
                name="player[name]"
                data-edit-player-modal-target="playerName"
              >
            </div>

            <div class="form-group">
              <label for="player-positions">Position(s)</label>
              <input
                type="text"
                id="player-positions"
                name="player[positions]"
                data-edit-player-modal-target="playerPositions"
                placeholder="e.g., 1B/OF or SP"
              >
              <small class="text-muted">
                Separate multiple positions with / (e.g., 1B/OF)
              </small>
            </div>

            <div class="form-group">
              <label for="player-team">
                Owned By Team
                <a href="#"
                   target="_blank"
                   data-edit-player-modal-target="teamLink"
                   style="font-size: 0.8em; font-weight: normal; margin-left: 0.5rem; color: #0066cc; text-decoration: none; display: none;">
                  ‚Üí View Team
                </a>
              </label>
              <select
                id="player-team"
                name="player[team_id]"
                data-edit-player-modal-target="playerTeam"
                data-action="change->edit-player-modal#onTeamChange"
              >
                <option value="">-- Unowned --</option>
                <% if @teams_for_modal %>
                  <% @teams_for_modal.each do |team| %>
                    <option value="<%= team.id %>"><%= team.name %></option>
                  <% end %>
                <% end %>
              </select>
            </div>

            <div class="form-group" data-edit-player-modal-target="priceField">
              <label for="player-price">Draft Price ($)</label>
              <input
                type="text"
                id="player-price"
                name="player[price]"
                data-edit-player-modal-target="playerPrice"
                value="N/A"
                readonly
              >
              <small class="text-muted">
                Price is set when player is assigned to a team
              </small>
            </div>

            <div class="form-group" data-edit-player-modal-target="positionField" style="display: none;">
              <label for="player-drafted-position">Roster Position</label>
              <select
                id="player-drafted-position"
                name="player[drafted_position]"
                data-edit-player-modal-target="playerDraftedPosition"
              >
                <option value="">Select position...</option>
                <option value="C">C - Catcher</option>
                <option value="1B">1B - First Base</option>
                <option value="2B">2B - Second Base</option>
                <option value="3B">3B - Third Base</option>
                <option value="SS">SS - Shortstop</option>
                <option value="MI">MI - Middle Infield</option>
                <option value="CI">CI - Corner Infield</option>
                <option value="OF">OF - Outfield</option>
                <option value="UTIL">UTIL - Utility</option>
                <option value="SP">SP - Starting Pitcher</option>
                <option value="RP">RP - Relief Pitcher</option>
              </select>
              <small class="text-muted">
                Position on the roster for this player
              </small>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-cancel btn-sm" data-action="click->edit-player-modal#close">
                Cancel
              </button>
              <button type="submit" class="btn btn-primary btn-sm">
                Save Changes
              </button>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal (Global) -->
    <div data-controller="confirmation-modal">
      <div class="modal hidden" data-confirmation-modal-target="modal" data-action="click->confirmation-modal#closeOnOutsideClick">
        <div class="modal-content" style="max-width: 400px;">
          <div class="modal-header">
            <h3 class="modal-title" data-confirmation-modal-target="title">Confirm</h3>
            <button class="modal-close" data-action="click->confirmation-modal#handleCancel" type="button">
              √ó
            </button>
          </div>

          <div class="modal-body">
            <p data-confirmation-modal-target="message"></p>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-cancel btn-sm"
              data-action="click->confirmation-modal#handleCancel"
              data-confirmation-modal-target="cancelButton">
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary btn-sm"
              data-action="click->confirmation-modal#handleConfirm"
              data-confirmation-modal-target="confirmButton">
              OK
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
