<!DOCTYPE html>
<html>
  <head>
    <title>Fantasy Baseball Draft Kit</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body data-controller="edit-player-modal">
    <header>
      <div class="container">
        <div class="flex justify-between items-center">
          <h1>⚾ Fantasy Baseball Draft Kit</h1>
          <nav>
            <%= link_to "Leagues", leagues_path %>
            <%= link_to "Players", players_path %>
            <%= link_to "Data Control", data_control_path %>
            <%= link_to "API Docs", "/api_testing_guide.html" %>
          </nav>
        </div>
      </div>
    </header>

    <main class="container">
      <% if flash[:notice] %>
        <div class="flash flash-notice">
          <%= flash[:notice] %>
        </div>
      <% end %>

      <% if flash[:alert] %>
        <div class="flash flash-alert">
          <%= flash[:alert] %>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <!-- Edit Player Modal (Global) -->
    <div class="modal hidden" data-edit-player-modal-target="modal" data-action="click->edit-player-modal#closeOnOutsideClick">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Edit Player</h3>
          <button class="modal-close" data-action="click->edit-player-modal#close" type="button">
            ×
          </button>
        </div>

        <div class="modal-body">
          <!-- Error display area -->
          <div id="edit-player-error"></div>

          <!-- Edit Player Form -->
          <%= form_with model: Player.new, url: "", method: :patch,
              data: {
                action: "submit->edit-player-modal#submit",
                turbo: true,
                edit_player_modal_target: "form"
              } do |f| %>

            <input type="hidden" name="_method" value="patch">

            <div class="form-group">
              <label for="player-name">Player Name</label>
              <input
                type="text"
                id="player-name"
                name="player[name]"
                data-edit-player-modal-target="playerName"
              >
            </div>

            <div class="form-group">
              <label for="player-positions">Position(s)</label>
              <input
                type="text"
                id="player-positions"
                name="player[positions]"
                data-edit-player-modal-target="playerPositions"
                placeholder="e.g., 1B/OF or SP"
              >
              <small class="text-muted">
                Separate multiple positions with / (e.g., 1B/OF)
              </small>
            </div>

            <div class="form-group">
              <label for="player-mlb-team">MLB Team</label>
              <input
                type="text"
                id="player-mlb-team"
                name="player[mlb_team]"
                data-edit-player-modal-target="playerMlbTeam"
                placeholder="e.g., NYY, BOS, LAD"
              >
            </div>

            <div class="form-group">
              <label for="player-value">Calculated Value ($)</label>
              <input
                type="number"
                id="player-value"
                name="player[calculated_value]"
                data-edit-player-modal-target="playerValue"
                step="0.01"
                min="0"
              >
            </div>

            <div class="form-group">
              <label>
                <input
                  type="checkbox"
                  name="player[is_drafted]"
                  data-edit-player-modal-target="playerIsDrafted"
                >
                Mark as Drafted
              </label>
              <small class="text-muted">
                Check this to manually mark player as drafted (use Undo button to reverse actual draft picks)
              </small>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-cancel btn-sm" data-action="click->edit-player-modal#close">
                Cancel
              </button>
              <button type="submit" class="btn btn-primary btn-sm">
                Save Changes
              </button>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal (Global) -->
    <div data-controller="confirmation-modal">
      <div class="modal hidden" data-confirmation-modal-target="modal" data-action="click->confirmation-modal#closeOnOutsideClick">
        <div class="modal-content" style="max-width: 400px;">
          <div class="modal-header">
            <h3 class="modal-title" data-confirmation-modal-target="title">Confirm</h3>
            <button class="modal-close" data-action="click->confirmation-modal#handleCancel" type="button">
              ×
            </button>
          </div>

          <div class="modal-body">
            <p data-confirmation-modal-target="message"></p>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-cancel btn-sm"
              data-action="click->confirmation-modal#handleCancel"
              data-confirmation-modal-target="cancelButton">
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary btn-sm"
              data-action="click->confirmation-modal#handleConfirm"
              data-confirmation-modal-target="confirmButton">
              OK
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
